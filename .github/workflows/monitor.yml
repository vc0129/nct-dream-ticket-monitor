name: NCT DREAM Ticket Monitor

on:
  schedule:
    # æ¯ 5 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
    - cron: '*/5 * * * *'
  # ä¹Ÿå¯ä»¥æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Check March 29 Ticket Availability
        run: |
          echo "æª¢æŸ¥ 3æœˆ29æ—¥å ´æ¬¡é–€ç¥¨ç‹€æ…‹..."
          
          # ç²å–é é¢å…§å®¹
          response=$(curl -s "https://tkglobal.melon.com/performance/index.htm?langCd=EN&prodId=212676")
          
          # æª¢æŸ¥æ˜¯å¦åŒæ™‚åŒ…å« "Mar 29, 2026" å’Œ "Available Seats"
          if echo "$response" | grep -q "Mar 29, 2026" && echo "$response" | grep -q "Available Seats"; then
            echo "âœ… 3æœˆ29æ—¥å ´æ¬¡æœ‰ç¥¨äº†ï¼"
            
            # ç™¼é€ Discord é€šçŸ¥
            curl -H "Content-Type: application/json" \
              -d '{"content":"ğŸ« **NCT DREAM 3æœˆ29æ—¥é–€ç¥¨æé†’**\n\nâœ… 3æœˆ29æ—¥å ´æ¬¡ç¾åœ¨æœ‰ç¥¨äº†ï¼è«‹ç«‹å³è³¼è²·ï¼š\nhttps://tkglobal.melon.com/performance/index.htm?langCd=EN&prodId=212676\n\næ™‚é–“ï¼š'$(date -u)'"}' \
              ${{ secrets.DISCORD_WEBHOOK_URL }}
            
            echo "ğŸ“± å·²ç™¼é€ Discord é€šçŸ¥ - 3æœˆ29æ—¥æœ‰ç¥¨"
          else
            echo "âŒ 3æœˆ29æ—¥å ´æ¬¡ç›®å‰æ²’æœ‰ç¥¨"
          fi
