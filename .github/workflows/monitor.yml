name: NCT DREAM Ticket Monitor

on:
  schedule:
    # æ¯ 5 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
    - cron: '*/5 * * * *'
  # ä¹Ÿå¯ä»¥æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Check Ticket Availability
        run: |
          echo "æ­£åœ¨æª¢æŸ¥ NCT DREAM é–€ç¥¨ç‹€æ…‹..."
          
          # ç²å–é é¢å…§å®¹
          response=$(curl -s "https://tkglobal.melon.com/performance/index.htm?langCd=EN&prodId=212676")
          
          # æª¢æŸ¥æ˜¯å¦æœ‰ "Available Seats" å­—æ¨£
          if echo "$response" | grep -q "Available Seats"; then
            echo "âœ… ç™¼ç¾å¯ç”¨åº§ä½ï¼"
            
            # ç™¼é€ Discord é€šçŸ¥
            curl -H "Content-Type: application/json" \
              -d '{"content":"ğŸ« **NCT DREAM é–€ç¥¨æé†’**\n\né–€ç¥¨å¯èƒ½æœ‰è²¨äº†ï¼è«‹ç«‹å³æŸ¥çœ‹ï¼š\nhttps://tkglobal.melon.com/performance/index.htm?langCd=EN&prodId=212676\n\næ™‚é–“ï¼š'$(date -u)'"}' \
              ${{ secrets.DISCORD_WEBHOOK_URL }}
            
            echo "ğŸ“± å·²ç™¼é€ Discord é€šçŸ¥"
          else
            echo "âŒ æš«æ™‚æ²’æœ‰ç™¼ç¾å¯ç”¨åº§ä½"
          fi
          
      - name: Check Specific Dates
        run: |
          echo "æª¢æŸ¥å…·é«”å ´æ¬¡è³‡è¨Š..."
          
          # æª¢æŸ¥é é¢æ˜¯å¦åŒ…å«å ´æ¬¡è³‡è¨Š
          response=$(curl -s "https://tkglobal.melon.com/performance/index.htm?langCd=EN&prodId=212676")
          
          if echo "$response" | grep -q "Mar 20, 2026"; then
            echo "âœ… æ‰¾åˆ° 3æœˆ20æ—¥å ´æ¬¡"
          fi
          
          if echo "$response" | grep -q "Mar 21, 2026"; then
            echo "âœ… æ‰¾åˆ° 3æœˆ21æ—¥å ´æ¬¡"
          fi
          
          if echo "$response" | grep -q "VIP"; then
            echo "âœ… æ‰¾åˆ° VIP åº§ä½è³‡è¨Š"
          fi
